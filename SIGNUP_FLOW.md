# Waitlist Signup Flow Documentation

## Overview

The complete waitlist signup flow now redirects users to a dedicated confirmation page after form submission, displaying personalized messaging and sharing options.

## Flow Diagram

```
Landing Page (/)
    ↓
Hero: "Join Waitlist" button
    ↓ (scrolls to #waitlist)
    ↓
WaitlistSection Form
    ↓ (user fills: firstName, email, phone)
    ↓
Submit: "Join 1,000+ New Yorkers waiting for Bridge"
    ↓
[Backend submission - TODO]
    ↓
Generate refCode (FIRSTNAME + 4 random digits)
    ↓
Redirect to /confirmation?firstName={}&email={}&refCode={}
    ↓
WaitlistConfirmation Component
    ↓
Display: Personalized message + Share module
```

## Components Involved

### 1. **Landing Page** (`app/page.tsx`)
- Contains Hero section with CTA button
- Includes WaitlistSection component

### 2. **Hero Component** (`app/components/hero/Hero.tsx`)
- Primary CTA: Scrolls to `#waitlist` section
- Text: "Join Waitlist"

### 3. **WaitlistSection** (`app/components/sections/WaitlistSection.tsx`)
- Form fields: firstName (required), lastName (optional), email (required), phone (optional)
- City: Fixed to "New York City"
- On submit:
  1. Validates required fields
  2. Simulates backend API call (900ms delay)
  3. Generates refCode using `generateRefCode(firstName)`
  4. Redirects to `/confirmation` with URL params

### 4. **Confirmation Page** (`app/confirmation/page.tsx`)
- Reads URL search params: `firstName`, `email`, `refCode`
- Renders `WaitlistConfirmation` component
- Uses Suspense for loading state

### 5. **WaitlistConfirmation Component** (`app/components/confirmation/WaitlistConfirmation.tsx`)
- Displays personalized success message
- Shows share module (if refCode exists)
- Handles copy/SMS/email sharing
- Optional friend email invite

## URL Parameters

The confirmation page expects these query parameters:

```typescript
interface ConfirmationParams {
  firstName?: string;  // User's first name for personalization
  email?: string;      // User's email for display in message
  refCode?: string;    // Unique referral code (e.g., "SARAH2847")
}
```

**Example URL:**
```
http://localhost:3000/confirmation?firstName=Sarah&email=sarah@example.com&refCode=SARAH2847
```

## RefCode Generation

### Current Implementation (Frontend)
Location: `app/lib/refcode.ts`

```typescript
generateRefCode(firstName: string): string
// Example: "Sarah" → "SARAH2847"
// Format: UPPERCASE_NAME + 4_RANDOM_DIGITS
```

### Production Implementation (TODO)
The refCode should be generated by the backend API and returned after successful signup:

```typescript
// Backend endpoint (to be implemented)
POST /api/waitlist
Body: { firstName, lastName, email, phone, city }
Response: { success: true, refCode: "SARAH2847" }
```

## State Management

### WaitlistSection State
- `form`: FormState with all input values
- `touched`: Track which fields have been blurred (for validation)
- `loading`: True during form submission
- ~~`submitted`: Removed (was used for inline success state)~~

### WaitlistConfirmation State
- `friendEmail`: Input for optional friend invite
- `isSubmitting`: Friend invite submission state
- `copied`: Temporary state for copy button feedback

## Backend Integration Points

### 1. Waitlist Submission
```typescript
// In WaitlistSection.tsx, line 51
// TODO: Submit to backend API here
const response = await fetch('/api/waitlist', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    firstName: form.firstName,
    lastName: form.lastName,
    email: form.email,
    phone: form.phone,
    city: form.city,
  }),
});

const { refCode } = await response.json();
```

### 2. Friend Invite
```typescript
// In WaitlistConfirmation.tsx, line 73
// TODO: Implement invite endpoint
POST /api/invite
Body: { email: friendEmail, refCode: refCode }
Response: { success: boolean }
```

## Testing

### Manual Testing
1. Navigate to `http://localhost:3000`
2. Click "Join Waitlist" in Hero
3. Fill form: firstName, email (required)
4. Click "Join 1,000+ New Yorkers waiting for Bridge"
5. Should redirect to `/confirmation` with populated data
6. Verify personalized message displays
7. Test "Copy link" button (should show toast)
8. Test "Text" and "Email" buttons (should open native apps)

### Test URLs
```bash
# Complete data
http://localhost:3000/confirmation?firstName=Sarah&email=sarah@example.com&refCode=SARAH2847

# Missing firstName
http://localhost:3000/confirmation?email=anonymous@example.com&refCode=ANON2024

# Missing email
http://localhost:3000/confirmation?firstName=John&refCode=JOHN2024

# Missing refCode (hides share module)
http://localhost:3000/confirmation?firstName=Jane&email=jane@example.com
```

### Test Page
Interactive scenario tester: `http://localhost:3000/confirmation-test`

## Files Modified

```
app/
├── components/
│   ├── confirmation/
│   │   └── WaitlistConfirmation.tsx        [NEW]
│   └── sections/
│       └── WaitlistSection.tsx             [MODIFIED]
├── confirmation/
│   └── page.tsx                             [NEW]
├── confirmation-test/
│   └── page.tsx                             [NEW - for testing]
├── lib/
│   ├── refcode.ts                           [NEW]
│   ├── referral.ts                          [NEW]
│   └── __tests__/
│       └── referral.test.ts                 [NEW]
└── layout.tsx                               [MODIFIED - added Toaster]

package.json                                 [MODIFIED - added sonner]
```

## Migration Notes

### What Changed
- ✅ Removed inline success message from `WaitlistSection`
- ✅ Added redirect to `/confirmation` page
- ✅ Created dedicated confirmation route
- ✅ Integrated refCode generation
- ✅ Added Sonner toast notifications

### What Stayed the Same
- Form validation logic
- Required/optional fields
- Form styling and layout
- Submit button behavior

## Next Steps

1. **Backend Integration**
   - Implement `/api/waitlist` endpoint
   - Store submissions in Supabase
   - Generate and return unique refCodes from backend
   - Implement `/api/invite` for friend invites

2. **Analytics**
   - Track form submissions
   - Track share actions (copy, SMS, email)
   - Track friend invites

3. **Email Notifications**
   - Send confirmation email after signup
   - Send launch notification when live

4. **Enhancements**
   - Add loading skeleton for confirmation page
   - Implement referral tracking
   - Add social media sharing options
   - Create referral leaderboard
